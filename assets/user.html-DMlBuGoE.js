import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as n,e as o}from"./app-6Cgy3eAt.js";const a={},d=o(`<p>格式：<code>USER &lt;用户名&gt;[:&lt;用户组&gt;]</code></p><p><code>USER</code>指令和<code>WORKDIR</code>相似，都是改变环境状态并影响以后的层。<code>WORKDIR</code>是改变工作目录，<code>USER</code>则是改变之后层的执行<code>RUN</code>，<code>CMD</code>和<code>ENTRYPOINT</code>这类命令的身份。</p><p>注意，<code>USER</code>只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p><div class="language-docker line-numbers-mode" data-ext="docker" data-title="docker"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">RUN</span> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span>
<span class="token instruction"><span class="token keyword">USER</span> redis</span>
<span class="token instruction"><span class="token keyword">RUN</span> [ <span class="token string">&quot;redis-server&quot;</span> ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果以<code>root</code>执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程，不要使用<code>su</code>或者<code>sudo</code>，这些都需要比较麻烦的配置，而且TTY缺失的环境下经常出错。建议使用<code>gosu</code>。</p><div class="language-docker line-numbers-mode" data-ext="docker" data-title="docker"><pre class="language-docker"><code><span class="token comment"># 建立 redis 用户，并使用 gosu 换另一个用户执行命令</span>
<span class="token instruction"><span class="token keyword">RUN</span> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span>
<span class="token comment"># 下载 gosu</span>
<span class="token instruction"><span class="token keyword">RUN</span> wget -O /usr/local/bin/gosu <span class="token string">&quot;https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64&quot;</span> <span class="token operator">\\</span>
    &amp;&amp; chmod +x /usr/local/bin/gosu <span class="token operator">\\</span>
    &amp;&amp; gosu nobody true</span>
<span class="token comment"># 设置 CMD，并以另外的用户执行</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;exec&quot;</span>, <span class="token string">&quot;gosu&quot;</span>, <span class="token string">&quot;redis&quot;</span>, <span class="token string">&quot;redis-server&quot;</span> ]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),c=[d];function t(i,r){return s(),n("div",null,c)}const u=e(a,[["render",t],["__file","user.html.vue"]]),m=JSON.parse('{"path":"/docker/dockfile/user.html","title":"","lang":"en-US","frontmatter":{},"headers":[],"git":{"createdTime":1709890332000,"updatedTime":1709890332000,"contributors":[{"name":"George","email":"leiping@yunxianginvest.com","commits":1}]},"readingTime":{"minutes":0.86,"words":257},"filePathRelative":"docker/dockfile/user.md","localizedDate":"March 8, 2024","excerpt":"<p>格式：<code>USER &lt;用户名&gt;[:&lt;用户组&gt;]</code></p>\\n<p><code>USER</code>指令和<code>WORKDIR</code>相似，都是改变环境状态并影响以后的层。<code>WORKDIR</code>是改变工作目录，<code>USER</code>则是改变之后层的执行<code>RUN</code>，<code>CMD</code>和<code>ENTRYPOINT</code>这类命令的身份。</p>\\n<p>注意，<code>USER</code>只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p>"}');export{u as comp,m as data};
